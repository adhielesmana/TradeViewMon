# TradeViewMon - Stock Market Prediction Platform

## Overview
TradeViewMon is a full-stack financial application providing real-time stock market data monitoring and AI-powered price predictions. It is designed for traders and financial analysts to make informed decisions through actionable insights into market movements, generated by continuously fetching market data, employing ensemble machine learning models for short-term price predictions, and tracking prediction accuracy. The platform aims to offer a reliable and sophisticated tool for navigating financial markets.

## User Preferences
Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend
- **Framework**: React 18+ with TypeScript (Vite).
- **UI**: Shadcn/ui (Radix UI + Tailwind CSS) for a professional trading platform aesthetic.
- **State Management**: TanStack Query for server state with aggressive caching (30-60 sec refetch).
- **Routing**: Wouter for lightweight client-side routing across pages like Live Market, Predictions, AI Suggestions, and Backtesting.
- **Design System**: Inter (UI) and JetBrains Mono (numerical data) fonts, semantic colors for financial data, dark/light theme, responsive grid layouts.

### Backend
- **Runtime**: Node.js with Express.js.
- **API**: RESTful endpoints (`/api/market/*`, `/api/market/status`, `/api/predictions/*`, etc.) with JSON responses.
- **Real-Time Updates**: WebSocket for per-symbol updates (market, prediction, accuracy).
- **Scheduler**: Node-cron (every 60 seconds) for market data fetching, candle generation, prediction, and accuracy calculation.
- **Market Hours Detection**: Manages API calls based on market hours for Forex/Metals (Sunday 5PM - Friday 5PM EST) and 24/7 for Crypto, generating offline candles during closure.
- **Unified Signal Generator**: Centralizes BUY/SELL/HOLD signals using weighted scoring from various technical indicators (EMA, RSI, MACD, Stochastic, Price Trend, Candlestick Patterns) with strict decision thresholds (netScore > 40 for BUY, < -40 for SELL).
- **Prediction Engine**: Ensemble model combining Moving Average, Linear Regression, and multi-factor technical analysis, outputting predicted price, direction, confidence, and analysis breakdown.
- **AI Trading Analyzer**: GPT-5-nano (or fallback to technicals) for trade validation, integrating prediction model accuracy with 6 technical indicators to generate signals with strict low-risk conditions.
- **News Service**: RSS feed integration (configurable via Settings, default: Yahoo Finance) with OpenAI analysis to generate market predictions based on news sentiment, key factors, affected symbols, and trading recommendations.
- **Market Data Service**: Abstracted service supporting Gold-API.com (XAU, XAG, BTC) and Finnhub (GDX, GDXJ, NEM, SPX, DXY, USOIL), with on-demand historical data seeding and simulated data for unsupported symbols (US10Y).
- **Risk Manager**: Comprehensive risk management service (`server/risk-manager.ts`) enforcing:
  - **Daily Loss Limit**: Maximum 3% of account balance or $500 per day
  - **Consecutive Loss Halt**: Trading pauses after 3 consecutive losing trades
  - **Position Limits**: Maximum 2 concurrent open positions, max 5% of balance per trade
  - **Confidence Validation**: Requires AI confidence ≥75% AND technical confidence ≥60%
  - All limits are configurable via RiskLimits interface

### Auto-Trade Safety Pipeline
Every auto-trade must pass through 5 mandatory validation gates (in order):
1. **Risk Status Check**: Blocks if daily loss exceeded, consecutive losses hit limit, or max positions reached
2. **R:R Ratio Check**: Minimum 1.5:1 risk-reward ratio required
3. **Technical Confidence**: Minimum 60% confidence from technical analysis
4. **MANDATORY AI Validation**: OpenAI must approve with:
   - shouldTrade = true
   - riskLevel = "LOW" (only LOW risk trades allowed)
   - Direction agreement with technical signal
   - AI confidence ≥75%
5. **Position Size Validation**: Trade size within 5% of account balance

### Database
- **ORM**: Drizzle ORM with PostgreSQL (Neon serverless).
- **Schema**:
    1.  `market_data`: OHLCV candles (symbol, timestamp, OHLCV, interval).
    2.  `predictions`: AI-generated predictions (timestamp, target, predicted price/direction, model, confidence).
    3.  `accuracy_results`: Prediction validation (actual vs. predicted, difference, match flag).
    4.  `system_status`: Component health monitoring.
    5.  `price_state`: Price continuity (symbol, last open/close, timestamp).
    6.  `app_settings`: Encrypted application configuration and API keys.

### Session & Authentication
- **Session Management**: express-session with memorystore (in-memory) or connect-pg-simple (PostgreSQL).
- **Authentication**: Passport.js local strategy (bcrypt-hashed passwords), session-based with 24-hour expiry.
- **Supported Instruments**: XAUUSD, XAGUSD, DXY, US10Y, GDX, GDXJ, NEM, SPX, BTCUSD, USOIL.

## External Dependencies

### Third-Party APIs
- **Gold-API.com**: Real-time spot prices for XAU, XAG, BTC.
- **Finnhub**: Real-time stock/ETF prices for GDX, GDXJ, NEM, SPX, DXY, USOIL (requires API key).
- **OpenAI**: GPT-5-nano for AI-enhanced trading analysis (configurable via UI settings).

### Database
- **PostgreSQL**: Via Neon Serverless.

### UI Component Libraries
- **Radix UI**: Headless accessible components.
- **Recharts**: Chart rendering.
- **Lucide React**: Icon system.
- **date-fns**: Date formatting.

### Development Tools
- **Vite**: Frontend build tool.
- **ESBuild**: Server-side bundling.
- **TypeScript**: Type safety.
- **Tailwind CSS**: Styling.

### Utility Libraries
- **simple-statistics**: Statistical calculations.
- **node-cron**: Scheduled job execution.
- **zod**: Runtime schema validation.
- **class-variance-authority**: Component variant management.
- **wouter**: Lightweight routing.